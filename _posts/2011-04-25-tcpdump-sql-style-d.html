---
layout: post
title: TCPDUMP SQL style :D
date: '2011-04-25T14:00:00.002-03:00'
author: Alexandre Bargiela
tags: 
modified_time: '2011-04-25T14:02:54.967-03:00'
blogger_id: tag:blogger.com,1999:blog-7490778459153845376.post-6238102808011380919
blogger_orig_url: http://abargiela.blogspot.com/2011/04/tcpdump-sql-style-d.html
---

<small>Um amigo do trabalho Julio, nos passou esse cara abaixo, achei bastante útil, estou repassando :D</small><br /><small>Nesse caso estamos monitorando o MySQL, podemos ver pela porta 3306, porém apesar de não ter testado ainda ele pegue qualquer linguagem SQL, claro adaptando para a porta do mesmo, ainda vou testar ou caso você tenha testado por favor poste :D Grato.</small><br /><small> </small><br /><small> </small><br /><small> </small><br /><div style="background-color: black; color: lime;"><br /></div><div style="background-color: black; color: lime;"><small><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;tcpdump -i eth0 -s 0 -l -w - dst port 3306 | strings | perl -e '</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(&lt;&gt;){ </span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chomp; next if /^[^ ]+[ ]*$/;</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(/^(SELECT|UPDATE|DELETE|INSERT|SET|COMMIT|ROLLBACK|CREATE|DROP|ALTER)/i){</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (defined $q){</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print "$q\n";</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $q=$_;</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else{</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $_ =~ s/^[ \t]+//; $q.=" $_";</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="background-color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }'</span></small></div><div style="background-color: black; color: lime;"><br /></div><small>Espero que ajude assim como me auxiliou, abraço.</small><small><span style="background-color: black; color: lime; font-family: &quot;Courier New&quot;,Courier,monospace;"> </span></small>