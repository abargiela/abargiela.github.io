---
layout: post
title: "[ Varnish Troubleshoot ] Varnish Error to start"
date: '2011-08-26T15:39:00.000-03:00'
author: Alexandre Bargiela
tags: 
modified_time: '2011-08-26T15:39:48.438-03:00'
blogger_id: tag:blogger.com,1999:blog-7490778459153845376.post-8004272557014166634
blogger_orig_url: http://abargiela.blogspot.com/2011/08/varnish-troubleshoot-varnish-error-to.html
---

Olá,<br />Tive um problema para subir um varnish em produção e gostaria de compartilhar a solução:<br /><br />- Ao tentar o start, ocorre o erro:<br /><br /><span style="font-size: x-small;">[root@varnish-machine ~]#&nbsp;&nbsp;&nbsp;&nbsp; /etc/init.d/varnish&nbsp; start<br />[root@varnish-machine ~]# or:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [FAILED]</span><br /><br />- Ao tentar startar apenas usando o daemon, ocorre:<br /><br /><span style="font-size: x-small;">[root@varnish-machine ~]# varnishd <br />storage_file: filename: ./varnish.4lLrqn size 3586 MB.<br />Using old SHMFILE</span><br /><br />- Tentei então fazer um debug no init do varnish e então no final ele mostra o seguinte trecho em <b>negrito</b><br /><br /><span style="font-size: x-small;">[root@varnish-machine ~]# sh -x&nbsp;&nbsp;&nbsp;&nbsp; /etc/init.d/varnish&nbsp; start<br />+ echo -n 'Starting varnish HTTP accelerator: '<br />Starting varnish HTTP accelerator: + ulimit -n 131072<br />+ ulimit -l 82000<br />+ '[' '<b>-a :80&nbsp; -T 127.0.0.1:6082 -f /etc/varnish/default.vcl -u varnish -g varnish -h classic,116387 -p listen_depth=16384 -p overflow_max=10000 -p sess_timeout=5 -p session_linger=50 -p thread_pools=16 -p lru_interval=900 -p cli_timeout=20 -p ping_interval=5 -w 300,4096,60 -t 60 -s file,/var/lib/varnish/varnish_storage.bin,20G</b>' = '' ']'</span><br /><br /><br /><br />- Então tentei subir manualmente o varnish, e ai que encontrei o erro e a solução:<br /><span style="font-size: x-small;"><br />[root@varnish-machine ~]# varnishd&nbsp; -a :80&nbsp; -T 127.0.0.1:6082 -f /etc/varnish/default.vcl -u varnish -g varnish -h classic,116387 -p listen_depth=16384 -p overflow_max=10000 -p sess_timeout=5 -p session_linger=50 -p thread_pools=16 -p lru_interval=900 -p cli_timeout=20 -p ping_interval=5 -w 300,4096,60 -t 60 -s file,/var/lib/varnish/varnish_storage.bin,20G<br />storage_file: filename: /var/lib/varnish/varnish_storage.bin size 20480 MB.<br />Message from VCC-compiler:<br />Unused backend backend1, defined:<br /><b>(<span style="color: red;">/etc/varnish/backends.inc Line 29 Pos 9</span>)</b>backend backend1 {<br />--------########################--<br />Running VCC-compiler failed, exit 1<br />VCL compilation failed</span><br /><br />Havia um problema na VCL, acessei o arquivo, fui até a linha, corrigi e problema solucionado.<br /><br />Espero que ajude, abs.<br /><br />